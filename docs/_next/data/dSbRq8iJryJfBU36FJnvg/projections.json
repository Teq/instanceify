{"pageProps":{"slug":"projections","frontmatter":{"title":"Projections"},"githubLink":"https://github.com/teq/serialazy/tree/main/website/content/projections.page.md","markdown":"<h1 id=\"projections\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#projections\"><span class=\"icon icon-link\"></span></a>Projections</h1>\n<p>Projection is one of multiple variants of serialization for a given class.\nIt might be useful when data should be presented in different formats when passed across different data channels.</p>\n<p>By default all serializers are defined and serialization / deserialization is done in projection called <code>\"default\"</code>.</p>\n<p>Serializers for alternative projections can be defined using <code>@Serialize()</code> decorator\nwith <a href=\"/options#projection-decorator-option\"><code>\"projection\"</code></a> option:</p>\n<pre style=\"background: #2e3440\"><code class=\"language-ts\"><span style=\"color: #81A1C1\">import</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">deflate</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">inflate</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">Serialize</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">from</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">serialazy</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #81A1C1\">class</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">Position</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D08770\">@Serialize</span><span style=\"color: #D8DEE9FF\">() </span><span style=\"color: #4C566A\">// &#x3C;- defined in \"default\" projection</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D08770\">@Serialize</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">projection</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">alt</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">name</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">col</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\">)</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> x</span><span style=\"color: #81A1C1\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">number</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D08770\">@Serialize</span><span style=\"color: #D8DEE9FF\">() </span><span style=\"color: #4C566A\">// &#x3C;- defined in \"default\" projection</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D08770\">@Serialize</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">projection</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">alt</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">name</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">row</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\">)</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> y</span><span style=\"color: #81A1C1\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">number</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #ECEFF4\">}</span>\n</code></pre>\n<p>and later serialized / deserialized using <code>deflate</code> / <code>inflate</code>\nin required <a href=\"/options#projection-serialization-option\"><code>\"projection\"</code></a>:</p>\n<pre style=\"background: #2e3440\"><code class=\"language-ts\"><span style=\"color: #81A1C1\">const</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">pos</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">Object</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">assign</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #81A1C1\">new</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">Position</span><span style=\"color: #D8DEE9FF\">()</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">x</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">y</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">2</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\">)</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #81A1C1\">const</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">obj1</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">deflate</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #D8DEE9\">pos</span><span style=\"color: #D8DEE9FF\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #88C0D0\">expect</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #D8DEE9\">obj1</span><span style=\"color: #D8DEE9FF\">)</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">to</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">deep</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">equal</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">x</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">y</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">2</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\">)</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #81A1C1\">const</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">obj2</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">deflate</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #D8DEE9\">pos</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">projection</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">alt</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #88C0D0\">expect</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #D8DEE9\">obj2</span><span style=\"color: #D8DEE9FF\">)</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">to</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">deep</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">equal</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">col</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">1</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">row</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #B48EAD\">2</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\">)</span><span style=\"color: #81A1C1\">;</span>\n</code></pre>\n<p>Another example demonstrates that <code>User</code> serializes to its <code>id</code> when serialized in \"api\" projection.\nNote that it's not possible do deserialize it in \"api\" projection without defining corresponding <code>\"up\"</code>\ndeserialization function, which can be <a href=\"/async\">async</a> to be able to query a database for that user.</p>\n<pre style=\"background: #2e3440\"><code class=\"language-ts\"><span style=\"color: #81A1C1\">import</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">deflate</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">inflate</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">Serialize</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">from</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">serialazy</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #D08770\">@Serialize</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">projection</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">api</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">down</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">user</span><span style=\"color: #81A1C1\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">User</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=></span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">user</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">id</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\">)</span>\n<span style=\"color: #81A1C1\">class</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">User</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D08770\">@Serialize</span><span style=\"color: #D8DEE9FF\">() </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> id</span><span style=\"color: #81A1C1\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">string</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D08770\">@Serialize</span><span style=\"color: #D8DEE9FF\">() </span><span style=\"color: #81A1C1\">public</span><span style=\"color: #D8DEE9FF\"> email</span><span style=\"color: #81A1C1\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">string</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #81A1C1\">const</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">user</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">Object</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">assign</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #81A1C1\">new</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">User</span><span style=\"color: #D8DEE9FF\">()</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D8DEE9\">id</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">&#x3C;unique_id></span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D8DEE9\">email</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">john.doe@example.com</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\">)</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #88C0D0\">expect</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #88C0D0\">deflate</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #D8DEE9\">user</span><span style=\"color: #D8DEE9FF\">))</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">to</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">deep</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">equal</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D8DEE9\">id</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">&#x3C;unique_id></span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D8DEE9\">email</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">john.doe@example.com</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\">)</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #88C0D0\">expect</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #88C0D0\">deflate</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #D8DEE9\">user</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">projection</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">api</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\">))</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">to</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">deep</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">equal</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #A3BE8C\">&#x3C;unique_id></span><span style=\"color: #ECEFF4\">\"</span><span style=\"color: #D8DEE9FF\">)</span><span style=\"color: #81A1C1\">;</span>\n</code></pre>\n<h2 id=\"fallback-to-default-projection\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#fallback-to-default-projection\"><span class=\"icon icon-link\"></span></a>Fallback to \"default\" projection</h2>\n<p><code>\"default\"</code> projection has a special role. It is used as a fallback if type is not serializable in given projection.\nThis behaviour can be disabled by setting <a href=\"/options#fallbacktodefaultprojection\"><code>\"fallbackToDefaultProjection\"</code></a> to <code>false</code>\nwhen calling <code>deflate</code> / <code>inflate</code>.</p>\n<blockquote>\n<p><strong>Note:</strong> Serializers for primitive types (string, number, boolean) are defined in <code>\"default\"</code> projection and\nalways used as a fallback, regardless of the value of <code>\"fallbackToDefaultProjection\"</code>.</p>\n</blockquote>"},"__N_SSG":true}